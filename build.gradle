/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.0/samples
 */
import org.gradle.internal.FileUtils
abstract class GenerateChordProPdfsTask extends DefaultTask {
    @TaskAction
    void buildChord() throws Exception {
            for (File choFile:project.fileTree("src").getFiles()) {
                File pdfFile = new File(project.getBuildDir().getAbsolutePath() +"/"+  FileUtils.removeExtension(choFile.getName()) + ".pdf");
                getProject().exec(execSpec -> {
                    try {
                        execSpec.setStandardOutput(new FileOutputStream(pdfFile));
                        execSpec.setExecutable("chordpro");
                        execSpec.setArgs(Arrays.asList(choFile.getAbsolutePath(), "--config=./config/chordpro.json"));
                    } catch (FileNotFoundException e) {
                        e.printStackTrace();
                    }
                });
            }
    }
}

project.getTasks().register("generateChordProPdfs", GenerateChordProPdfsTask.class);